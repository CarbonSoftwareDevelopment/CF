<app-nav></app-nav>
<div class="container">
  <div class="row">
    <div class="col-lg-8 col-sm-10 offset-lg-2 offset-sm-1 box">
      <mat-horizontal-stepper #stepper>
        <!--[linear]="true"-->
        <mat-step [stepControl]="fileForm">
          <form [formGroup]="fileForm">
            <ng-template matStepLabel>File Details</ng-template>
            <mat-form-field>
              <input matInput placeholder="File Reference" formControlName="fileRef" required>
              <mat-error *ngIf="fileRef.hasError('required')">
                File Reference is required.
              </mat-error>
            </mat-form-field>
            <mat-form-field>
              <input matInput placeholder="Cause of action" formControlName="action" [matAutocomplete]="actions" required>
              <mat-error *ngIf="action.hasError('required')">
                Action Type is required.
              </mat-error>
              <mat-autocomplete #actions="matAutocomplete" (optionSelected)="actionTypeSelected($event.option)">
                <mat-option *ngFor="let action of filteredActions | async" [value]="action">
                  {{ action }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <mat-form-field>
              <input matInput placeholder="Our Reference" formControlName="ourRef" required>
              <mat-error *ngIf="ourRef.hasError('required')">
                Our Reference is required.
              </mat-error>
            </mat-form-field>
            <mat-form-field>
              <mat-select placeholder="Milestone Process" [formControl]="milestoneProc" required>
                <mat-option>--</mat-option>
                <mat-option *ngFor="let ml of milestonesLists" [value]="ml">
                  {{ml}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="milestoneProc.hasError('required')">
                Milestone Process is required.
              </mat-error>
            </mat-form-field>
            <div>
              <button class="btn btn-primary btn-sm" matStepperNext>Next</button>
            </div>
          </form>
        </mat-step>
        <mat-step [stepControl]="propForm">
          <form [formGroup]="propForm">
            <ng-template matStepLabel>Property Details</ng-template>
            <mat-form-field>
              <input matInput placeholder="Property Type" formControlName="propType" [matAutocomplete]="props" required>
              <mat-error *ngIf="propType.hasError('required')">
                Property Type is required.
              </mat-error>
              <mat-autocomplete #props="matAutocomplete" (optionSelected)="propTypeSelected($event.option)">
                <mat-option *ngFor="let type of filteredProps | async" [value]="type">
                  {{ type }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <mat-form-field>
              <input matInput placeholder="Deeds Office" formControlName="deedsOffice" [matAutocomplete]="deed" required>
              <mat-error *ngIf="deedsOffice.hasError('required')">
                Deeds Office is required.
              </mat-error>
              <mat-autocomplete #deed="matAutocomplete" (optionSelected)="deedsSelected($event.option)">
                <mat-option *ngFor="let d of filteredDeeds | async" [value]="d">
                  {{ d }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <mat-form-field>
              <input matInput placeholder="Erf Number" formControlName="erfNum" required>
              <mat-error *ngIf="erfNum.hasError('required')">
                Erf Number is required.
              </mat-error>
            </mat-form-field>
            <mat-form-field>
              <input type="number" matInput placeholder="Portion Number" formControlName="portionNum" required>
              <mat-error *ngIf="portionNum.hasError('required')">
                Portion Number is required.
              </mat-error>
            </mat-form-field>
            <div>
              <button class="btn btn-primary btn-sm" matStepperNext>Next</button>
              <button style="margin-right: 5px;" class="btn btn-outline-secondary btn-sm" matStepperPrevious>Back</button>
            </div>
          </form>
        </mat-step>
        <mat-step>
          <ng-template matStepLabel>Add Contacts</ng-template>
          <div class="row contactsRow">
            <div class="col-6 fileCol dropBox">
              <div class="contactHeaders">
                <h5>File Contacts</h5>
              </div>
              <div
                cdkDropList
                #fileContactListElement="cdkDropList"
                [cdkDropListData]="fileContactsList"
                [cdkDropListConnectedTo]="[myContactsElement]"
                class="example-list"
                (cdkDropListDropped)="drop($event)">
                <div class="hint" *ngIf="fileContactsList.length === 0" style="color: gray">Drag and drop contacts here to add them to the file</div>
                <div class="example-box" *ngFor="let ct of fileContactsList" cdkDrag>{{ct?.name}}</div>
              </div>
            </div>
            <div class="col-6 contactsCol dropBox">
              <div class="contactHeaders">
                <h5>My Contacts</h5>
                <mat-form-field>
                  <input matInput placeholder="Search My Contacts"
                         (keyup)="searchTerm$.next($event.target.value)">
                  <span matPrefix><i class="fas fa-search"></i>&nbsp;</span>
                </mat-form-field>
              </div>
              <div
                cdkDropList
                #myContactsElement="cdkDropList"
                [cdkDropListData]="filteredContacts"
                [cdkDropListConnectedTo]="[fileContactListElement]"
                class="example-list"
                (cdkDropListDropped)="drop($event)">
                <div class="example-box" *ngFor="let ct of filteredContacts" cdkDrag>
                  {{ct?.name}}
                </div>
              </div>
            </div>
          </div>
        </mat-step>
      </mat-horizontal-stepper>
    </div>
  </div>
</div>
